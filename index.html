<html>
    <head>
        <link rel="stylesheet" type="text/css" href="index.css">
    </head>

    <body>
        <div id="player">
            <script src="http://www.youtube.com/player_api"></script>
            <script src="https://apis.google.com/js/client.js"></script>

            <!-- Generate ID script -->
            <script>
                function rndChoice(vec) {
                    return vec[Math.floor(Math.random() * vec.length)]
                }

                function range(start, end) {
                    var list = [];
                    for (var i = start; i <= end; i++) {
                        list.push(i);
                    }
                    return list;
                }

                function generateSearchQuery() {
                    var prefix = rndChoice(["IMG ", "IMG_", "IMG-", "DSC"]);
                    var num = rndChoice(range(999, 9999));
                    var postfix = rndChoice([" MOV", ".MOV", " .MOV"]);
                    return `${prefix}${num}${postfix}`;
                }
            </script>

            <!-- Search script-->
            <script>
            /**
             * Sample JavaScript code for youtube.search.list
             * See instructions for running APIs Explorer code samples locally:
             * https://developers.google.com/explorer-help/guides/code_samples#javascript
             */

            // function authenticate() {
            //     return gapi.auth2.getAuthInstance()
            //         .signIn({scope: "https://www.googleapis.com/auth/youtube.force-ssl"})
            //         .then(
            //             function() { console.log("Sign-in successful"); },
            //             function(err) { console.error("Error signing in", err); });
            // }

            // function loadClient() {
            //     return gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest")
            //         .then(
            //             function() { console.log("GAPI client loaded for API"); },
            //             function(err) { console.error("Error loading GAPI client for API", err); });
            // }

            // // Make sure the client is loaded and sign-in is complete before calling this method.
            // function search() {
            //     var request = gapi.client.youtube.search.list({
            //         "part": "snippet",
            //         "q":  generateSearchQuery()});
                
            //     request.execute((response) => alert(response));
            // }
            
            // gapi.load("client:auth2", function() {
            //     gapi.auth2.init({client_id: "667994396877-e0kuq4pb757f0s95h0b99lr4478hv46m.apps.googleusercontent.com"}); 
            // });
            
            function search(){
                gapi.client.setApiKey('API key here');
                gapi.client.load('youtube', 'v3', function() {makeRequest();});
            }

            function makeRequest() {
                console.log(gapi.client);
                var request = gapi.client.youtube.search.list({
                        q: generateSearchQuery(),
                        part: 'snippet'                        
                });

                request.execute(function(response) {
                        var str = JSON.stringify(response.result);                
                        alert(str);
                });
            }
            </script>

            <!-- Control Player script -->
            <script>
                var player;
                function onYouTubePlayerAPIReady() {
                    player = new YT.Player('player', {
                    width: '640',
                    height: '390',
                    videoId: '0Bmhjf0rKe8',
                    events: {
                        onReady: onPlayerReady,
                        onStateChange: onPlayerStateChange
                    }
                    });
                }

                // autoplay video
                function onPlayerReady(event) {
                    event.target.playVideo();
                }

                // when video ends
                function onPlayerStateChange(event) {        
                    if(event.data === 0) {          
                        alert(generateSearchQuery());
                    }
                }
            </script>
    
        </div>
            
        <button onclick="authenticate().then(loadClient)">authorize and load</button>
        <button onclick="search()">SEARCH</button>

    </body>

</html>